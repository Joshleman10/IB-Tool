<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Air vs Ground Analysis</title>

  <!-- External libraries -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Styles - Updated to root-relative paths -->
  <link rel="stylesheet" href="/IB-Tool/shared/sidebar.css" />
  <link rel="stylesheet" href="/IB-Tool/airVsGroundAnalyzer/styles.css" />
</head>

<body>
  <!-- Sidebar Injection -->
  <div id="sidebar-container"></div>

  <!-- Main Content Area -->
  <div class="main">
    <h1>Air vs Ground Analysis</h1>

    <div id="dateRange" style="text-align: center; margin-top: 0.5rem; font-size: 1rem; color: #555;">
      Date Range: Not loaded
    </div>

    <!-- File Upload Section -->
    <div class="upload-section">
      <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
        üìÇ Select Excel File to Analyze
      </button>
      <input type="file" id="fileInput" accept=".xlsx, .xls" style="display:none" onchange="handleFile(event)" />

      <!-- File Info Display -->
      <div class="file-info" id="fileInfo" style="display: none;">
        <div class="file-details">
          <span class="file-icon">üìÑ</span>
          <div class="file-text">
            <div class="file-name" id="fileName"></div>
            <div class="file-metadata">
              <span id="fileSize"></span> ‚Ä¢
              <span id="fileDate"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Date Comparison Controls -->
    <div class="date-range-controls" id="dateRangeControls" style="display: none;">
      <h3>üìä Compare Time Periods</h3>
      <div class="date-ranges">
        <div class="period-group">
          <label class="period-label period-1-label">Period 1:</label>
          <div class="period-inputs">
            <input type="date" id="period1Start" class="date-input">
            <span class="date-separator">to</span>
            <input type="date" id="period1End" class="date-input">
          </div>
        </div>
        <div class="period-group">
          <label class="period-label period-2-label">Period 2:</label>
          <div class="period-inputs">
            <input type="date" id="period2Start" class="date-input">
            <span class="date-separator">to</span>
            <input type="date" id="period2End" class="date-input">
          </div>
        </div>
      </div>
      <div class="comparison-buttons">
        <button onclick="comparePeriods()" class="compare-btn">üîç Compare Periods</button>
        <button onclick="resetToFullData()" class="reset-btn">üìÖ Show All Data</button>
      </div>
    </div>

    <!-- Charts Section -->
    <div id="chartsSection">
      <!-- Full Data Charts (Default) -->
      <div id="fullDataCharts">
        <div id="dailyChartContainer" class="single-chart-container">
          <canvas id="dailyChart"></canvas>
        </div>
        <div id="percentChartContainer" class="single-chart-container">
          <canvas id="percentChart"></canvas>
        </div>
      </div>

      <!-- Comparison Charts (Hidden by default) -->
      <div id="comparisonCharts" style="display: none;">
        <div class="comparison-row">
          <div class="chart-half">
            <h4 class="chart-title period-1-title">Period 1 - Daily Trends</h4>
            <canvas id="dailyChart1"></canvas>
          </div>
          <div class="chart-half">
            <h4 class="chart-title period-2-title">Period 2 - Daily Trends</h4>
            <canvas id="dailyChart2"></canvas>
          </div>
        </div>
        <div class="comparison-row">
          <div class="chart-half">
            <h4 class="chart-title period-1-title">Period 1 - Percentages</h4>
            <canvas id="percentChart1"></canvas>
          </div>
          <div class="chart-half">
            <h4 class="chart-title period-2-title">Period 2 - Percentages</h4>
            <canvas id="percentChart2"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Metrics Section -->
    <div class="metrics-section" id="metricsSection">
      <!-- Full Data Metrics (Default) -->
      <div id="fullDataMetrics">
        <div class="metrics-category">
          <h3>Volume & Distribution</h3>
          <p id="smallVolTotal"></p>
          <p id="total212"></p>
        </div>
        <div class="metrics-category">
          <h3>Air Metrics</h3>
          <p id="airPercent"></p>
          <p id="cartAirPercent"></p>
          <p id="cartAirTotal"></p>
          <p id="avgAirTime"></p>
          <p id="totalAirTrans"></p>
        </div>
        <div class="metrics-category">
          <h3>Ground Metrics</h3>
          <p id="groundPercent"></p>
          <p id="cartGroundTotal"></p>
          <p id="avgGroundTime"></p>
          <p id="totalGroundTrans"></p>
        </div>
      </div>

      <!-- Comparison Metrics (Hidden by default) -->
      <div id="comparisonMetrics" style="display: none;">
        <div class="comparison-metrics-row">
          <div class="metrics-half">
            <h3 class="period-1-title">Period 1 Metrics</h3>
            <div class="mini-metrics-grid">
              <div class="mini-metric">
                <h4>Volume & Distribution</h4>
                <p id="smallVolTotal1"></p>
                <p id="total2121"></p>
              </div>
              <div class="mini-metric">
                <h4>Air Metrics</h4>
                <p id="airPercent1"></p>
                <p id="cartAirPercent1"></p>
                <p id="cartAirTotal1"></p>
                <p id="avgAirTime1"></p>
                <p id="totalAirTrans1"></p>
              </div>
              <div class="mini-metric">
                <h4>Ground Metrics</h4>
                <p id="groundPercent1"></p>
                <p id="cartGroundTotal1"></p>
                <p id="avgGroundTime1"></p>
                <p id="totalGroundTrans1"></p>
              </div>
            </div>
          </div>
          <div class="metrics-half">
            <h3 class="period-2-title">Period 2 Metrics (with % change)</h3>
            <div class="mini-metrics-grid">
              <div class="mini-metric">
                <h4>Volume & Distribution</h4>
                <p id="smallVolTotal2"></p>
                <p id="total2122"></p>
              </div>
              <div class="mini-metric">
                <h4>Air Metrics</h4>
                <p id="airPercent2"></p>
                <p id="cartAirPercent2"></p>
                <p id="cartAirTotal2"></p>
                <p id="avgAirTime2"></p>
                <p id="totalAirTrans2"></p>
              </div>
              <div class="mini-metric">
                <h4>Ground Metrics</h4>
                <p id="groundPercent2"></p>
                <p id="cartGroundTotal2"></p>
                <p id="avgGroundTime2"></p>
                <p id="totalGroundTrans2"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button onclick="downloadReport()">üìÑ Download Report</button>
      <button onclick="clearAirGroundData()" id="clearButton" style="display: none;">üîÑ Clear Data</button>
    </div>

    <footer>
      Excel Cart Analyzer ¬∑ v1.5 ¬∑ Updated August 2025
    </footer>
  </div>

  <!-- Hidden textarea for input data if needed -->
  <textarea id="inputData" style="display:none;"></textarea>

  <!-- Custom Logic -->
  <script>
    fetch("/IB-Tool/shared/sidebar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("sidebar-container").innerHTML = html;
      });
  </script>
  
  <!-- JavaScript - Updated to root-relative path -->
  <script src="/IB-Tool/airVsGroundAnalyzer/airVsGround.js"></script>
</body>

</html>