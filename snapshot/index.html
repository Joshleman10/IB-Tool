<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snapshot Analyzer</title>

  <!-- Environment Detection Script -->
  <script>
    // Auto-detect environment and set base path
    const isLocal = window.location.hostname === 'localhost' || 
                    window.location.hostname === '127.0.0.1' || 
                    window.location.hostname === '';
    const basePath = isLocal ? '' : '/IB-Tool';
    
    // Function to create path-aware links
    function createLink(href, rel = 'stylesheet') {
      const link = document.createElement('link');
      link.rel = rel;
      link.href = basePath + href;
      document.head.appendChild(link);
    }
    
    // Create CSS links
    createLink('/shared/sidebar.css');
    createLink('/snapshot/styles.css');
  </script>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
  <!-- Sidebar -->
  <div id="sidebar-container"></div>

  <!-- Main Content -->
  <div class="main">
    <h1>📊 Operational Snapshot Analyzer</h1>

    <!-- File Upload Section -->
    <div class="input-section">
      <div class="input-card">
        <h2>📂 Upload Excel Data</h2>
        <p>Select your operational Excel file for analysis:</p>
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
          📊 Select Excel File
        </button>
        <input type="file" id="fileInput" accept=".xlsx, .xls" onchange="handleFile(event)" style="display: none;" />

        <!-- File Info Display -->
        <div class="file-info" id="fileInfo" style="display: none;">
          <div class="file-details">
            <span class="file-icon">📄</span>
            <div class="file-text">
              <div class="file-name" id="fileName"></div>
              <div class="file-metadata">
                <span id="fileSize"></span> •
                <span id="fileDate"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Paste Data Section -->
      <div class="input-card">
        <h2>📋 Paste Labor Data</h2>
        <p>Click the button below and paste your Chewy Labor Management System data:</p>
        <button class="paste-btn" onclick="handlePasteClick()">
          📋 Click & Paste Labor Data
        </button>
        <div class="processing-status" id="processingStatus" style="display: none;">
          <span class="processing-text">🔄 Processing data...</span>
        </div>
        <!-- Hidden textarea for paste handling -->
        <textarea id="hiddenPasteArea" style="position: absolute; left: -9999px; opacity: 0;"></textarea>
      </div>
    </div>

    <!-- KPI Dashboard -->
    <div class="kpi-dashboard" id="kpiDashboard" style="display: none;">
      <h2>📈 Key Performance Indicators</h2>
      <div class="kpi-grid" id="kpiGrid"></div>
    </div>

    <!-- Detailed Analysis -->
    <div class="analysis-section" id="analysisSection" style="display: none;">
      <div class="analysis-tabs">
        <button class="tab-btn active" onclick="switchTab('labor')">👥 Labor Analysis</button>
        <button class="tab-btn" onclick="switchTab('productivity')">🛠️ VAS/CART/CRET</button>
        <button class="tab-btn" onclick="switchTab('efficiency')">🎯 Efficiency</button>
        <button class="tab-btn" onclick="switchTab('combined')">🔗 Combined Insights</button>
      </div>

      <div class="tab-content active" id="laborTab">
        <div class="analysis-card">
          <h3>Labor Department Breakdown</h3>
          <div id="laborBreakdown"></div>
        </div>
      </div>
      <div class="tab-content" id="productivityTab">
        <div class="analysis-card">
          <h3>VAS, CART & CRET Analysis</h3>
          <div id="productivityMetrics"></div>
        </div>
      </div>
      <div class="tab-content" id="efficiencyTab">
        <div class="analysis-card">
          <h3>Efficiency Analysis</h3>
          <div id="efficiencyAnalysis"></div>
        </div>
      </div>

      <div class="tab-content" id="combinedTab">
        <div class="analysis-card">
          <h3>Combined Data Insights</h3>
          <div id="combinedInsights"></div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" id="actionButtons" style="display: none;">
      <button onclick="exportResults()" class="export-btn">💾 Export Results</button>
      <button onclick="clearAllData()" class="reset-button">🔄 Clear All Data</button>
    </div>

    <!-- Data Status -->
    <div class="data-status" id="dataStatus">
      <div class="status-item">
        <span class="status-label">Excel Data:</span>
        <span class="status-value" id="excelStatus">Not Loaded</span>
      </div>
      <div class="status-item">
        <span class="status-label">Labor Data:</span>
        <span class="status-value" id="laborStatus">Not Loaded</span>
      </div>
    </div>
  </div>
  <!-- Script to load sidebar - Environment-aware -->
  <script>
    // Global navigation function for sidebar
    window.navigateToTool = function(path) {
      if (path === '') {
        // Home page
        window.location.href = basePath + '/';
      } else {
        // Tool pages
        window.location.href = basePath + '/' + path;
      }
    };

    fetch(basePath + "/shared/sidebar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("sidebar-container").innerHTML = html;
      });
  </script>
  
  <!-- Core configuration and utilities first - Environment-aware paths -->
  <script>
    // Load all JavaScript files with environment-aware paths
    const jsFiles = [
      '/snapshot/js/snapshot-config.js',
      '/snapshot/js/snapshot-utils.js',
      '/snapshot/js/snapshot-data.js',
      '/snapshot/js/snapshot-calculations.js',
      '/snapshot/js/snapshot-display.js',
      '/snapshot/js/snapshot-storage.js',
      '/snapshot/js/snapshot-insights.js',
      '/snapshot/js/snapshot-main.js'
    ];
    
    jsFiles.forEach(file => {
      const script = document.createElement('script');
      script.src = basePath + file;
      document.head.appendChild(script);
    });
  </script>

</body>

</html>